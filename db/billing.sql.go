// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: billing.sql

package db

import (
	"context"
	"database/sql"
)

const createMachineType = `-- name: CreateMachineType :exec
INSERT INTO machine_types (machine_type, display_name, vcpu, memory_gib, stripe_price_id, monthly_price_cents, active)
VALUES (?, ?, ?, ?, ?, ?, ?)
`

type CreateMachineTypeParams struct {
	MachineType       string       `json:"machine_type"`
	DisplayName       string       `json:"display_name"`
	Vcpu              int32        `json:"vcpu"`
	MemoryGib         int32        `json:"memory_gib"`
	StripePriceID     string       `json:"stripe_price_id"`
	MonthlyPriceCents int32        `json:"monthly_price_cents"`
	Active            sql.NullBool `json:"active"`
}

func (q *Queries) CreateMachineType(ctx context.Context, arg CreateMachineTypeParams) error {
	_, err := q.db.ExecContext(ctx, createMachineType,
		arg.MachineType,
		arg.DisplayName,
		arg.Vcpu,
		arg.MemoryGib,
		arg.StripePriceID,
		arg.MonthlyPriceCents,
		arg.Active,
	)
	return err
}

const createStripeSubscription = `-- name: CreateStripeSubscription :execresult
INSERT INTO stripe_subscriptions (
  public_id, organization_id, stripe_subscription_id, stripe_customer_id, stripe_checkout_session_id,
  status, current_period_start, current_period_end, trial_start, trial_end,
  cancel_at_period_end, canceled_at, machine_type, disk_size_gb, created_at, updated_at
) VALUES (UUID_TO_BIN(UUID_V7()), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, NOW(), NOW())
`

type CreateStripeSubscriptionParams struct {
	OrganizationID          int64                     `json:"organization_id"`
	StripeSubscriptionID    string                    `json:"stripe_subscription_id"`
	StripeCustomerID        string                    `json:"stripe_customer_id"`
	StripeCheckoutSessionID sql.NullString            `json:"stripe_checkout_session_id"`
	Status                  StripeSubscriptionsStatus `json:"status"`
	CurrentPeriodStart      sql.NullTime              `json:"current_period_start"`
	CurrentPeriodEnd        sql.NullTime              `json:"current_period_end"`
	TrialStart              sql.NullTime              `json:"trial_start"`
	TrialEnd                sql.NullTime              `json:"trial_end"`
	CancelAtPeriodEnd       sql.NullBool              `json:"cancel_at_period_end"`
	CanceledAt              sql.NullTime              `json:"canceled_at"`
	MachineType             sql.NullString            `json:"machine_type"`
	DiskSizeGb              sql.NullInt32             `json:"disk_size_gb"`
}

func (q *Queries) CreateStripeSubscription(ctx context.Context, arg CreateStripeSubscriptionParams) (sql.Result, error) {
	return q.db.ExecContext(ctx, createStripeSubscription,
		arg.OrganizationID,
		arg.StripeSubscriptionID,
		arg.StripeCustomerID,
		arg.StripeCheckoutSessionID,
		arg.Status,
		arg.CurrentPeriodStart,
		arg.CurrentPeriodEnd,
		arg.TrialStart,
		arg.TrialEnd,
		arg.CancelAtPeriodEnd,
		arg.CanceledAt,
		arg.MachineType,
		arg.DiskSizeGb,
	)
}

const deleteStripeSubscription = `-- name: DeleteStripeSubscription :exec
DELETE FROM stripe_subscriptions WHERE stripe_subscription_id = ?
`

func (q *Queries) DeleteStripeSubscription(ctx context.Context, stripeSubscriptionID string) error {
	_, err := q.db.ExecContext(ctx, deleteStripeSubscription, stripeSubscriptionID)
	return err
}

const getMachineType = `-- name: GetMachineType :one
SELECT id, machine_type, display_name, vcpu, memory_gib, stripe_price_id, monthly_price_cents, active, created_at, updated_at
FROM machine_types
WHERE machine_type = ? AND active = TRUE
`

func (q *Queries) GetMachineType(ctx context.Context, machineType string) (MachineType, error) {
	row := q.db.QueryRowContext(ctx, getMachineType, machineType)
	var i MachineType
	err := row.Scan(
		&i.ID,
		&i.MachineType,
		&i.DisplayName,
		&i.Vcpu,
		&i.MemoryGib,
		&i.StripePriceID,
		&i.MonthlyPriceCents,
		&i.Active,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getMachineTypeByStripePriceID = `-- name: GetMachineTypeByStripePriceID :one
SELECT id, machine_type, display_name, vcpu, memory_gib, stripe_price_id, monthly_price_cents, active, created_at, updated_at
FROM machine_types
WHERE stripe_price_id = ? AND active = TRUE
`

func (q *Queries) GetMachineTypeByStripePriceID(ctx context.Context, stripePriceID string) (MachineType, error) {
	row := q.db.QueryRowContext(ctx, getMachineTypeByStripePriceID, stripePriceID)
	var i MachineType
	err := row.Scan(
		&i.ID,
		&i.MachineType,
		&i.DisplayName,
		&i.Vcpu,
		&i.MemoryGib,
		&i.StripePriceID,
		&i.MonthlyPriceCents,
		&i.Active,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getOnboardingSessionByStripeCheckoutID = `-- name: GetOnboardingSessionByStripeCheckoutID :one


SELECT id, BIN_TO_UUID(public_id) AS public_id, account_id, org_name, BIN_TO_UUID(organization_public_id) AS organization_public_id,
       machine_type, machine_price_id, disk_size_gb,
       stripe_checkout_session_id, stripe_checkout_url, stripe_subscription_id, organization_id,
       project_name, gcp_country, gcp_region, site_name, github_repo_url, port, firewall_ip,
       current_step, completed, expires_at, created_at, updated_at
FROM onboarding_sessions WHERE stripe_checkout_session_id = ?
`

type GetOnboardingSessionByStripeCheckoutIDRow struct {
	ID                      int64          `json:"id"`
	PublicID                string         `json:"public_id"`
	AccountID               int64          `json:"account_id"`
	OrgName                 sql.NullString `json:"org_name"`
	OrganizationPublicID    string         `json:"organization_public_id"`
	MachineType             sql.NullString `json:"machine_type"`
	MachinePriceID          sql.NullString `json:"machine_price_id"`
	DiskSizeGb              sql.NullInt32  `json:"disk_size_gb"`
	StripeCheckoutSessionID sql.NullString `json:"stripe_checkout_session_id"`
	StripeCheckoutUrl       sql.NullString `json:"stripe_checkout_url"`
	StripeSubscriptionID    sql.NullString `json:"stripe_subscription_id"`
	OrganizationID          sql.NullInt64  `json:"organization_id"`
	ProjectName             sql.NullString `json:"project_name"`
	GcpCountry              sql.NullString `json:"gcp_country"`
	GcpRegion               sql.NullString `json:"gcp_region"`
	SiteName                sql.NullString `json:"site_name"`
	GithubRepoUrl           sql.NullString `json:"github_repo_url"`
	Port                    sql.NullInt32  `json:"port"`
	FirewallIp              sql.NullString `json:"firewall_ip"`
	CurrentStep             sql.NullInt32  `json:"current_step"`
	Completed               sql.NullBool   `json:"completed"`
	ExpiresAt               sql.NullTime   `json:"expires_at"`
	CreatedAt               sql.NullTime   `json:"created_at"`
	UpdatedAt               sql.NullTime   `json:"updated_at"`
}

// =============================================================================
// PROJECTS
// =============================================================================
func (q *Queries) GetOnboardingSessionByStripeCheckoutID(ctx context.Context, stripeCheckoutSessionID sql.NullString) (GetOnboardingSessionByStripeCheckoutIDRow, error) {
	row := q.db.QueryRowContext(ctx, getOnboardingSessionByStripeCheckoutID, stripeCheckoutSessionID)
	var i GetOnboardingSessionByStripeCheckoutIDRow
	err := row.Scan(
		&i.ID,
		&i.PublicID,
		&i.AccountID,
		&i.OrgName,
		&i.OrganizationPublicID,
		&i.MachineType,
		&i.MachinePriceID,
		&i.DiskSizeGb,
		&i.StripeCheckoutSessionID,
		&i.StripeCheckoutUrl,
		&i.StripeSubscriptionID,
		&i.OrganizationID,
		&i.ProjectName,
		&i.GcpCountry,
		&i.GcpRegion,
		&i.SiteName,
		&i.GithubRepoUrl,
		&i.Port,
		&i.FirewallIp,
		&i.CurrentStep,
		&i.Completed,
		&i.ExpiresAt,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getStorageConfig = `-- name: GetStorageConfig :one
SELECT id, config_key, stripe_price_id, price_per_gb_cents, min_size_gb, max_size_gb, active, created_at, updated_at
FROM storage_config
WHERE config_key = 'disk_storage' AND active = TRUE
`

func (q *Queries) GetStorageConfig(ctx context.Context) (StorageConfig, error) {
	row := q.db.QueryRowContext(ctx, getStorageConfig)
	var i StorageConfig
	err := row.Scan(
		&i.ID,
		&i.ConfigKey,
		&i.StripePriceID,
		&i.PricePerGbCents,
		&i.MinSizeGb,
		&i.MaxSizeGb,
		&i.Active,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getStripeSubscription = `-- name: GetStripeSubscription :one
SELECT id, BIN_TO_UUID(public_id) AS public_id, organization_id, stripe_subscription_id, stripe_customer_id, stripe_checkout_session_id,
       status, current_period_start, current_period_end, trial_start, trial_end,
       cancel_at_period_end, canceled_at, machine_type, disk_size_gb, created_at, updated_at
FROM stripe_subscriptions WHERE public_id = UUID_TO_BIN(?)
`

type GetStripeSubscriptionRow struct {
	ID                      int64                     `json:"id"`
	PublicID                string                    `json:"public_id"`
	OrganizationID          int64                     `json:"organization_id"`
	StripeSubscriptionID    string                    `json:"stripe_subscription_id"`
	StripeCustomerID        string                    `json:"stripe_customer_id"`
	StripeCheckoutSessionID sql.NullString            `json:"stripe_checkout_session_id"`
	Status                  StripeSubscriptionsStatus `json:"status"`
	CurrentPeriodStart      sql.NullTime              `json:"current_period_start"`
	CurrentPeriodEnd        sql.NullTime              `json:"current_period_end"`
	TrialStart              sql.NullTime              `json:"trial_start"`
	TrialEnd                sql.NullTime              `json:"trial_end"`
	CancelAtPeriodEnd       sql.NullBool              `json:"cancel_at_period_end"`
	CanceledAt              sql.NullTime              `json:"canceled_at"`
	MachineType             sql.NullString            `json:"machine_type"`
	DiskSizeGb              sql.NullInt32             `json:"disk_size_gb"`
	CreatedAt               sql.NullTime              `json:"created_at"`
	UpdatedAt               sql.NullTime              `json:"updated_at"`
}

func (q *Queries) GetStripeSubscription(ctx context.Context, publicID string) (GetStripeSubscriptionRow, error) {
	row := q.db.QueryRowContext(ctx, getStripeSubscription, publicID)
	var i GetStripeSubscriptionRow
	err := row.Scan(
		&i.ID,
		&i.PublicID,
		&i.OrganizationID,
		&i.StripeSubscriptionID,
		&i.StripeCustomerID,
		&i.StripeCheckoutSessionID,
		&i.Status,
		&i.CurrentPeriodStart,
		&i.CurrentPeriodEnd,
		&i.TrialStart,
		&i.TrialEnd,
		&i.CancelAtPeriodEnd,
		&i.CanceledAt,
		&i.MachineType,
		&i.DiskSizeGb,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getStripeSubscriptionByStripeID = `-- name: GetStripeSubscriptionByStripeID :one
SELECT id, BIN_TO_UUID(public_id) AS public_id, organization_id, stripe_subscription_id, stripe_customer_id, stripe_checkout_session_id,
       status, current_period_start, current_period_end, trial_start, trial_end,
       cancel_at_period_end, canceled_at, machine_type, disk_size_gb, created_at, updated_at
FROM stripe_subscriptions WHERE stripe_subscription_id = ?
`

type GetStripeSubscriptionByStripeIDRow struct {
	ID                      int64                     `json:"id"`
	PublicID                string                    `json:"public_id"`
	OrganizationID          int64                     `json:"organization_id"`
	StripeSubscriptionID    string                    `json:"stripe_subscription_id"`
	StripeCustomerID        string                    `json:"stripe_customer_id"`
	StripeCheckoutSessionID sql.NullString            `json:"stripe_checkout_session_id"`
	Status                  StripeSubscriptionsStatus `json:"status"`
	CurrentPeriodStart      sql.NullTime              `json:"current_period_start"`
	CurrentPeriodEnd        sql.NullTime              `json:"current_period_end"`
	TrialStart              sql.NullTime              `json:"trial_start"`
	TrialEnd                sql.NullTime              `json:"trial_end"`
	CancelAtPeriodEnd       sql.NullBool              `json:"cancel_at_period_end"`
	CanceledAt              sql.NullTime              `json:"canceled_at"`
	MachineType             sql.NullString            `json:"machine_type"`
	DiskSizeGb              sql.NullInt32             `json:"disk_size_gb"`
	CreatedAt               sql.NullTime              `json:"created_at"`
	UpdatedAt               sql.NullTime              `json:"updated_at"`
}

func (q *Queries) GetStripeSubscriptionByStripeID(ctx context.Context, stripeSubscriptionID string) (GetStripeSubscriptionByStripeIDRow, error) {
	row := q.db.QueryRowContext(ctx, getStripeSubscriptionByStripeID, stripeSubscriptionID)
	var i GetStripeSubscriptionByStripeIDRow
	err := row.Scan(
		&i.ID,
		&i.PublicID,
		&i.OrganizationID,
		&i.StripeSubscriptionID,
		&i.StripeCustomerID,
		&i.StripeCheckoutSessionID,
		&i.Status,
		&i.CurrentPeriodStart,
		&i.CurrentPeriodEnd,
		&i.TrialStart,
		&i.TrialEnd,
		&i.CancelAtPeriodEnd,
		&i.CanceledAt,
		&i.MachineType,
		&i.DiskSizeGb,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const listAllMachineTypes = `-- name: ListAllMachineTypes :many
SELECT id, machine_type, display_name, vcpu, memory_gib, stripe_price_id, monthly_price_cents, active, created_at, updated_at
FROM machine_types
ORDER BY vcpu ASC, memory_gib ASC
`

func (q *Queries) ListAllMachineTypes(ctx context.Context) ([]MachineType, error) {
	rows, err := q.db.QueryContext(ctx, listAllMachineTypes)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []MachineType{}
	for rows.Next() {
		var i MachineType
		if err := rows.Scan(
			&i.ID,
			&i.MachineType,
			&i.DisplayName,
			&i.Vcpu,
			&i.MemoryGib,
			&i.StripePriceID,
			&i.MonthlyPriceCents,
			&i.Active,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listMachineTypes = `-- name: ListMachineTypes :many
SELECT id, machine_type, display_name, vcpu, memory_gib, stripe_price_id, monthly_price_cents, active, created_at, updated_at
FROM machine_types
WHERE active = TRUE
ORDER BY vcpu ASC, memory_gib ASC
`

func (q *Queries) ListMachineTypes(ctx context.Context) ([]MachineType, error) {
	rows, err := q.db.QueryContext(ctx, listMachineTypes)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []MachineType{}
	for rows.Next() {
		var i MachineType
		if err := rows.Scan(
			&i.ID,
			&i.MachineType,
			&i.DisplayName,
			&i.Vcpu,
			&i.MemoryGib,
			&i.StripePriceID,
			&i.MonthlyPriceCents,
			&i.Active,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updateMachineType = `-- name: UpdateMachineType :exec
UPDATE machine_types
SET display_name = ?, vcpu = ?, memory_gib = ?, stripe_price_id = ?, monthly_price_cents = ?, active = ?, updated_at = NOW()
WHERE machine_type = ?
`

type UpdateMachineTypeParams struct {
	DisplayName       string       `json:"display_name"`
	Vcpu              int32        `json:"vcpu"`
	MemoryGib         int32        `json:"memory_gib"`
	StripePriceID     string       `json:"stripe_price_id"`
	MonthlyPriceCents int32        `json:"monthly_price_cents"`
	Active            sql.NullBool `json:"active"`
	MachineType       string       `json:"machine_type"`
}

func (q *Queries) UpdateMachineType(ctx context.Context, arg UpdateMachineTypeParams) error {
	_, err := q.db.ExecContext(ctx, updateMachineType,
		arg.DisplayName,
		arg.Vcpu,
		arg.MemoryGib,
		arg.StripePriceID,
		arg.MonthlyPriceCents,
		arg.Active,
		arg.MachineType,
	)
	return err
}

const updateStripeSubscription = `-- name: UpdateStripeSubscription :exec
UPDATE stripe_subscriptions SET
  status = ?,
  current_period_start = ?,
  current_period_end = ?,
  trial_start = ?,
  trial_end = ?,
  cancel_at_period_end = ?,
  canceled_at = ?,
  machine_type = ?,
  disk_size_gb = ?,
  updated_at = NOW()
WHERE stripe_subscription_id = ?
`

type UpdateStripeSubscriptionParams struct {
	Status               StripeSubscriptionsStatus `json:"status"`
	CurrentPeriodStart   sql.NullTime              `json:"current_period_start"`
	CurrentPeriodEnd     sql.NullTime              `json:"current_period_end"`
	TrialStart           sql.NullTime              `json:"trial_start"`
	TrialEnd             sql.NullTime              `json:"trial_end"`
	CancelAtPeriodEnd    sql.NullBool              `json:"cancel_at_period_end"`
	CanceledAt           sql.NullTime              `json:"canceled_at"`
	MachineType          sql.NullString            `json:"machine_type"`
	DiskSizeGb           sql.NullInt32             `json:"disk_size_gb"`
	StripeSubscriptionID string                    `json:"stripe_subscription_id"`
}

func (q *Queries) UpdateStripeSubscription(ctx context.Context, arg UpdateStripeSubscriptionParams) error {
	_, err := q.db.ExecContext(ctx, updateStripeSubscription,
		arg.Status,
		arg.CurrentPeriodStart,
		arg.CurrentPeriodEnd,
		arg.TrialStart,
		arg.TrialEnd,
		arg.CancelAtPeriodEnd,
		arg.CanceledAt,
		arg.MachineType,
		arg.DiskSizeGb,
		arg.StripeSubscriptionID,
	)
	return err
}
