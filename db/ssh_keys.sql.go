// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: ssh_keys.sql

package db

import (
	"context"
	"database/sql"
)

const createSshAccess = `-- name: CreateSshAccess :exec
INSERT INTO ssh_access (
  account_id, site_id, created_at, updated_at, created_by, updated_by
) VALUES (?, ?, NOW(), NOW(), ?, ?)
`

type CreateSshAccessParams struct {
	AccountID int64         `json:"account_id"`
	SiteID    int64         `json:"site_id"`
	CreatedBy sql.NullInt64 `json:"created_by"`
	UpdatedBy sql.NullInt64 `json:"updated_by"`
}

func (q *Queries) CreateSshAccess(ctx context.Context, arg CreateSshAccessParams) error {
	_, err := q.db.ExecContext(ctx, createSshAccess,
		arg.AccountID,
		arg.SiteID,
		arg.CreatedBy,
		arg.UpdatedBy,
	)
	return err
}

const createSshKey = `-- name: CreateSshKey :execresult
INSERT INTO ssh_keys (
  public_id, account_id, public_key, ` + "`" + `name` + "`" + `, fingerprint, created_at, updated_at
) VALUES (
  UUID_TO_BIN(?),
  (SELECT id FROM accounts WHERE accounts.public_id = UUID_TO_BIN(?)),
  ?, ?, ?,
  CURRENT_TIMESTAMP, CURRENT_TIMESTAMP
)
`

type CreateSshKeyParams struct {
	PublicID        string         `json:"public_id"`
	AccountPublicID string         `json:"account_public_id"`
	PublicKey       string         `json:"public_key"`
	Name            sql.NullString `json:"name"`
	Fingerprint     sql.NullString `json:"fingerprint"`
}

func (q *Queries) CreateSshKey(ctx context.Context, arg CreateSshKeyParams) (sql.Result, error) {
	return q.db.ExecContext(ctx, createSshKey,
		arg.PublicID,
		arg.AccountPublicID,
		arg.PublicKey,
		arg.Name,
		arg.Fingerprint,
	)
}

const deleteSshAccess = `-- name: DeleteSshAccess :exec
DELETE FROM ssh_access WHERE account_id = ? AND site_id = ?
`

type DeleteSshAccessParams struct {
	AccountID int64 `json:"account_id"`
	SiteID    int64 `json:"site_id"`
}

func (q *Queries) DeleteSshAccess(ctx context.Context, arg DeleteSshAccessParams) error {
	_, err := q.db.ExecContext(ctx, deleteSshAccess, arg.AccountID, arg.SiteID)
	return err
}

const deleteSshKey = `-- name: DeleteSshKey :exec
DELETE FROM ssh_keys WHERE public_id = UUID_TO_BIN(?)
`

func (q *Queries) DeleteSshKey(ctx context.Context, publicID string) error {
	_, err := q.db.ExecContext(ctx, deleteSshKey, publicID)
	return err
}

const getSshAccess = `-- name: GetSshAccess :one
SELECT id, account_id, site_id, created_at, updated_at, created_by, updated_by
FROM ssh_access WHERE account_id = ? AND site_id = ?
`

type GetSshAccessParams struct {
	AccountID int64 `json:"account_id"`
	SiteID    int64 `json:"site_id"`
}

func (q *Queries) GetSshAccess(ctx context.Context, arg GetSshAccessParams) (SshAccess, error) {
	row := q.db.QueryRowContext(ctx, getSshAccess, arg.AccountID, arg.SiteID)
	var i SshAccess
	err := row.Scan(
		&i.ID,
		&i.AccountID,
		&i.SiteID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.CreatedBy,
		&i.UpdatedBy,
	)
	return i, err
}

const getSshKey = `-- name: GetSshKey :one
SELECT sk.id, BIN_TO_UUID(sk.public_id) AS public_id,
       BIN_TO_UUID(a.public_id) AS account_public_id,
       sk.public_key, sk.` + "`" + `name` + "`" + `, sk.fingerprint,
       sk.created_at, sk.updated_at
FROM ssh_keys sk
JOIN accounts a ON sk.account_id = a.id
WHERE sk.public_id = UUID_TO_BIN(?)
`

type GetSshKeyRow struct {
	ID              int64          `json:"id"`
	PublicID        string         `json:"public_id"`
	AccountPublicID string         `json:"account_public_id"`
	PublicKey       string         `json:"public_key"`
	Name            sql.NullString `json:"name"`
	Fingerprint     sql.NullString `json:"fingerprint"`
	CreatedAt       sql.NullTime   `json:"created_at"`
	UpdatedAt       sql.NullTime   `json:"updated_at"`
}

func (q *Queries) GetSshKey(ctx context.Context, publicID string) (GetSshKeyRow, error) {
	row := q.db.QueryRowContext(ctx, getSshKey, publicID)
	var i GetSshKeyRow
	err := row.Scan(
		&i.ID,
		&i.PublicID,
		&i.AccountPublicID,
		&i.PublicKey,
		&i.Name,
		&i.Fingerprint,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const updateSshKey = `-- name: UpdateSshKey :execresult
UPDATE ssh_keys SET
  ` + "`" + `name` + "`" + ` = ?,
  updated_at = CURRENT_TIMESTAMP
WHERE public_id = UUID_TO_BIN(?)
`

type UpdateSshKeyParams struct {
	Name     sql.NullString `json:"name"`
	PublicID string         `json:"public_id"`
}

func (q *Queries) UpdateSshKey(ctx context.Context, arg UpdateSshKeyParams) (sql.Result, error) {
	return q.db.ExecContext(ctx, updateSshKey, arg.Name, arg.PublicID)
}
