// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: deployments.sql

package db

import (
	"context"
	"database/sql"
)

const createDeployment = `-- name: CreateDeployment :exec
INSERT INTO deployments (
  id, site_id, ` + "`" + `status` + "`" + `, github_run_id, github_run_url, started_at, completed_at, error_message, created_at
) VALUES (?, ?, ?, ?, ?, ?, ?, ?, NOW())
`

type CreateDeploymentParams struct {
	ID           string            `json:"id"`
	SiteID       string            `json:"site_id"`
	Status       DeploymentsStatus `json:"status"`
	GithubRunID  sql.NullString    `json:"github_run_id"`
	GithubRunUrl sql.NullString    `json:"github_run_url"`
	StartedAt    int64             `json:"started_at"`
	CompletedAt  sql.NullInt64     `json:"completed_at"`
	ErrorMessage sql.NullString    `json:"error_message"`
}

func (q *Queries) CreateDeployment(ctx context.Context, arg CreateDeploymentParams) error {
	_, err := q.db.ExecContext(ctx, createDeployment,
		arg.ID,
		arg.SiteID,
		arg.Status,
		arg.GithubRunID,
		arg.GithubRunUrl,
		arg.StartedAt,
		arg.CompletedAt,
		arg.ErrorMessage,
	)
	return err
}

const deleteDeployment = `-- name: DeleteDeployment :exec
DELETE FROM deployments WHERE id = ?
`

func (q *Queries) DeleteDeployment(ctx context.Context, id string) error {
	_, err := q.db.ExecContext(ctx, deleteDeployment, id)
	return err
}

const getDeployment = `-- name: GetDeployment :one
SELECT id, site_id, ` + "`" + `status` + "`" + `, github_run_id, github_run_url, started_at, completed_at, error_message, created_at
FROM deployments WHERE id = ?
`

func (q *Queries) GetDeployment(ctx context.Context, id string) (Deployment, error) {
	row := q.db.QueryRowContext(ctx, getDeployment, id)
	var i Deployment
	err := row.Scan(
		&i.ID,
		&i.SiteID,
		&i.Status,
		&i.GithubRunID,
		&i.GithubRunUrl,
		&i.StartedAt,
		&i.CompletedAt,
		&i.ErrorMessage,
		&i.CreatedAt,
	)
	return i, err
}

const getLatestSiteDeployment = `-- name: GetLatestSiteDeployment :one
SELECT id, site_id, status, github_run_id, github_run_url, started_at, completed_at, error_message, created_at FROM deployments
WHERE site_id = ?
ORDER BY created_at DESC
LIMIT 1
`

func (q *Queries) GetLatestSiteDeployment(ctx context.Context, siteID string) (Deployment, error) {
	row := q.db.QueryRowContext(ctx, getLatestSiteDeployment, siteID)
	var i Deployment
	err := row.Scan(
		&i.ID,
		&i.SiteID,
		&i.Status,
		&i.GithubRunID,
		&i.GithubRunUrl,
		&i.StartedAt,
		&i.CompletedAt,
		&i.ErrorMessage,
		&i.CreatedAt,
	)
	return i, err
}

const listSiteDeployments = `-- name: ListSiteDeployments :many
SELECT id, site_id, status, github_run_id, github_run_url, started_at, completed_at, error_message, created_at FROM deployments
WHERE site_id = ?
ORDER BY created_at DESC
LIMIT ? OFFSET ?
`

type ListSiteDeploymentsParams struct {
	SiteID string `json:"site_id"`
	Limit  int32  `json:"limit"`
	Offset int32  `json:"offset"`
}

func (q *Queries) ListSiteDeployments(ctx context.Context, arg ListSiteDeploymentsParams) ([]Deployment, error) {
	rows, err := q.db.QueryContext(ctx, listSiteDeployments, arg.SiteID, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Deployment{}
	for rows.Next() {
		var i Deployment
		if err := rows.Scan(
			&i.ID,
			&i.SiteID,
			&i.Status,
			&i.GithubRunID,
			&i.GithubRunUrl,
			&i.StartedAt,
			&i.CompletedAt,
			&i.ErrorMessage,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updateDeployment = `-- name: UpdateDeployment :exec
UPDATE deployments SET
  ` + "`" + `status` + "`" + ` = ?,
  github_run_id = ?,
  github_run_url = ?,
  completed_at = ?,
  error_message = ?
WHERE id = ?
`

type UpdateDeploymentParams struct {
	Status       DeploymentsStatus `json:"status"`
	GithubRunID  sql.NullString    `json:"github_run_id"`
	GithubRunUrl sql.NullString    `json:"github_run_url"`
	CompletedAt  sql.NullInt64     `json:"completed_at"`
	ErrorMessage sql.NullString    `json:"error_message"`
	ID           string            `json:"id"`
}

func (q *Queries) UpdateDeployment(ctx context.Context, arg UpdateDeploymentParams) error {
	_, err := q.db.ExecContext(ctx, updateDeployment,
		arg.Status,
		arg.GithubRunID,
		arg.GithubRunUrl,
		arg.CompletedAt,
		arg.ErrorMessage,
		arg.ID,
	)
	return err
}
